C51 COMPILER V9.56.0.0   MAIN                                                              09/23/2016 23:49:13 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.exe main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          
   2          /***************************************************************************************
   3           *  函式中變數宣告請宣告於函式開頭
   4           *
   5           *
   6           ***************************************************************************************/
   7          #include <regx51.h>
   8          
   9          /****************************************************************************************
  10           *      don't edit this section
  11           *      不要修改以下這段code
  12           * *************************************************************************************/
  13          #define DATA_PIN P1_0   //DS
  14          #define CLOCK_PIN P1_1  //SHCP
  15          #define LATCH_PIN P1_2  //STCP
  16          #define LAYER_1 P1_3
  17          #define LAYER_2 P1_4
  18          #define LAYER_3 P1_5
  19          #define LAYER_4 P1_6
  20          
  21          #define MSBFIRST 1
  22          #define LSBFIRST 2
  23          #define HIGH 1
  24          #define LOW 0
  25          #define ON 1
  26          #define OFF 0
  27          
  28          short LED[4];   //LED condition
  29          
  30          
  31          /****************************************************************************************
  32           **函數: shiftOut
  33           **輸入: BitOrder(LSB first or MSB first),val
  34           **輸出: 無
  35           **功能: shift out data to DS
  36           **************************************************************************************/
  37          void shiftOut(unsigned char BitOrder,unsigned char val);
  38          void clock_delay();
  39          /****************************************************************************************
  40           *      you can call these function
  41           *      你可以使用以下函式
  42           **************************************************************************************/
  43          
  44          /****************************************************************************************
  45           **函數: init
  46           **輸入: 無
  47           **輸出: 無
  48           **功能: configure AT89C51 and 74HC595
  49           * *************************************************************************************/
  50          void init();
  51          
  52          /****************************************************************************************
  53           **函數: delay
  54           **輸入: x
C51 COMPILER V9.56.0.0   MAIN                                                              09/23/2016 23:49:13 PAGE 2   

  55           **輸出: 無
  56           **功能: delay 1ms
  57           **************************************************************************************/
  58          void delay(unsigned int);
  59          
  60          /****************************************************************************************
  61           **函數: turnOn
  62           **輸入: x,y,x (LED的座標)
  63           **輸出: 無
  64           **功能: turn on one LED in data
  65           *       在資料庫中開啟一個LED
  66           * *************************************************************************************/
  67          void turnOn(unsigned char x, unsigned char y, unsigned char z);
  68          
  69          /****************************************************************************************
  70           **函數: turnOff
  71           **輸入: x,y,x (LED的座標)
  72           **輸出: 無
  73           **功能: turn off one LED in data
  74           *       在資料庫中關閉一個LED
  75           **************************************************************************************/
  76          void turnOff(unsigned char x, unsigned char y, unsigned char z);
  77          
  78          /****************************************************************************************
  79           **函數: isOn
  80           **輸入: x,y,x (LED的座標)
  81           **輸出: 無
  82           **功能: check one LED is ON
  83           *       檢查一個LED是否開啟或關閉
  84           * *************************************************************************************/
  85          unsigned char isOn(unsigned char x, unsigned char y, unsigned char z);
  86          
  87          /****************************************************************************************
  88           **函數: display
  89           **輸入: times  (loop次數)
  90           **輸出: 無
  91           **功能: Starting Display LED cube by this function
  92           *       用這個函式開始顯示LED 方塊
  93           **************************************************************************************/
  94          void display(unsigned int times);
  95          
  96          /****************************************************************************************
  97           *      main function
  98           *      主函式
  99           ***************************************************************************************/
 100          void main()
 101          {
 102   1          //int x;
 103   1          init();
 104   1          while(1){
 105   2              LED[0] = 0x1212;
 106   2              turnOn(3,0,1);
 107   2              turnOn(1,1,1);
 108   2              turnOn(3,1,1);
 109   2              turnOn(1,2,1);
 110   2              turnOn(3,2,1);
 111   2              turnOn(1,3,1);
 112   2              turnOn(3,3,1);
 113   2              LED[2] = 0x5555;
 114   2              LED[3] = 0xAAAA;
 115   2              while(1){
 116   3                  display(0);
C51 COMPILER V9.56.0.0   MAIN                                                              09/23/2016 23:49:13 PAGE 3   

 117   3              }
 118   2          }
 119   1      }
 120          
 121          
 122          /****************************************************************************************
 123           *      don't edit this section
 124           *      不要修改以下這段code
 125           * *************************************************************************************/
 126          void delay(unsigned int x)
 127          {
 128   1          unsigned int i,j;
 129   1          for (i = 0 ; i < x ; i++ )
 130   1              for (j = 0 ; j < 240 ; j++ );
 131   1      }
 132          
 133          void init()
 134          {
 135   1          CLOCK_PIN = 0;
 136   1          LATCH_PIN = 1;
 137   1          DATA_PIN = 0;
 138   1          LAYER_1 = 0;
 139   1          LAYER_2 = 0;
 140   1          LAYER_3 = 0;
 141   1          LAYER_4 = 0;
 142   1          LED[0] = 0;
 143   1          LED[1] = 0;
 144   1          LED[2] = 0;
 145   1          LED[3] = 0;
 146   1      }
 147          
 148          void clock_delay()
 149          {
 150   1          unsigned char i;
 151   1          for (i = 0 ; i < 5 ; i++);
 152   1      }
 153          
 154          
 155          void shiftOut(unsigned char BitOrder,unsigned char val)
 156          {
 157   1          unsigned char i;
 158   1          for (i = 0 ; i < 8 ; i++){
 159   2              if (BitOrder == LSBFIRST)
 160   2                  DATA_PIN = !!(val & (1<<i));
 161   2              else
 162   2                  DATA_PIN = !!(val & (1<<(7-i)));
 163   2              CLOCK_PIN = 1;
 164   2              CLOCK_PIN = 0;
 165   2          }
 166   1      }
 167          
 168          void turnOn(unsigned char x, unsigned char y, unsigned char z)
 169          {
 170   1          LED[z] |= ( 1 << ((y << 2)+x));
 171   1      }
 172          
 173          void turnOff(unsigned char x, unsigned char y, unsigned char z)
 174          {
 175   1          LED[z] &= ~(1 << ((y<<2)+x));
 176   1      }
 177          
 178          unsigned char isOn(unsigned char x, unsigned char y, unsigned char z)
C51 COMPILER V9.56.0.0   MAIN                                                              09/23/2016 23:49:13 PAGE 4   

 179          {
 180   1          return ( LED[z] >> (( y << 2 ) + x ) ) & 1 ;
 181   1      }
 182          
 183          void display(unsigned int times)
 184          {
 185   1          int iter;
 186   1          unsigned char high_byte,low_byte;
 187   1          while(times--){
 188   2              for (iter = 0 ; iter < 4 ; iter ++ ){
 189   3                  high_byte = LED[iter] & 0xFF;
 190   3                  low_byte =  LED[iter] >> 8;
 191   3                  LATCH_PIN = 0;
 192   3                  shiftOut(LSBFIRST,high_byte);
 193   3                  shiftOut(LSBFIRST,low_byte);
 194   3                  //LATCH_PIN = 1;  
 195   3                      
 196   3                  P2 = 0x00;
 197   3                  switch(iter){
 198   4                      case 0:
 199   4                          P1 = 0x0C;
 200   4                          break;
 201   4                      case 1:
 202   4                          P1 = 0x14;
 203   4                          break;
 204   4                      case 2:
 205   4                          P1 = 0x24;
 206   4                          break;
 207   4                      case 3:
 208   4                          P1 = 0x44;
 209   4                          break;
 210   4                      default:
 211   4                          P2_1 = 1;
 212   4                          break;
 213   4                  }   
 214   3              }
 215   2          }
 216   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    515    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
