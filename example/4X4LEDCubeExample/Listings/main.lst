C51 COMPILER V9.56.0.0   MAIN                                                              09/19/2016 16:00:49 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          
   2          /***************************************************************************************
   3           *  函式中變數宣告請宣告於函式開頭
   4           *
   5           *
   6           ***************************************************************************************/
   7          #include <regx51.h>
   8          
   9          /****************************************************************************************
  10           *      don't edit this section
  11           *      不要修改以下這段code
  12           * *************************************************************************************/
  13          #define DATA_PIN P1_0   //DS
  14          #define CLOCK_PIN P1_1  //SHCP
  15          #define LATCH_PIN P1_2  //STCP
  16          #define LAYER_1 P1_3
  17          #define LAYER_2 P1_4
  18          #define LAYER_3 P1_5
  19          #define LAYER_4 P1_6
  20          
  21          #define MSBFIRST 1
  22          #define LSBFIRST 2
  23          #define HIGH 1
  24          #define LOW 0
  25          #define ON 1
  26          #define OFF 0
  27          
  28          short LED[4];   //LED condition
  29          
  30          /****************************************************************************************
  31           **函數: delay
  32           **輸入: x
  33           **輸出: 無
  34           **功能: delay 1ms
  35           **************************************************************************************/
  36          void delay(unsigned int);
  37          
  38          /****************************************************************************************
  39           **函數: shiftOut
  40           **輸入: BitOrder(LSB first or MSB first),val
  41           **輸出: 無
  42           **功能: shift out data to DS
  43           **************************************************************************************/
  44          void shiftOut(unsigned char BitOrder,unsigned char val);
  45          
  46          /****************************************************************************************
  47           *      you can call these function
  48           *      你可以使用以下函式
  49           **************************************************************************************/
  50          
  51          /****************************************************************************************
  52           **函數: init
  53           **輸入: 無
  54           **輸出: 無
C51 COMPILER V9.56.0.0   MAIN                                                              09/19/2016 16:00:49 PAGE 2   

  55           **功能: configure AT89C51 and 74HC595
  56           * *************************************************************************************/
  57          void init();
  58          
  59          /****************************************************************************************
  60           **函數: turnOn
  61           **輸入: x,y,x (LED的座標)
  62           **輸出: 無
  63           **功能: turn on one LED in data
  64           *       在資料庫中開啟一個LED
  65           * *************************************************************************************/
  66          void turnOn(unsigned char x, unsigned char y, unsigned char z);
  67          
  68          /****************************************************************************************
  69           **函數: turnOff
  70           **輸入: x,y,x (LED的座標)
  71           **輸出: 無
  72           **功能: turn off one LED in data
  73           *       在資料庫中關閉一個LED
  74           **************************************************************************************/
  75          void turnOff(unsigned char x, unsigned char y, unsigned char z);
  76          
  77          /****************************************************************************************
  78           **函數: isOn
  79           **輸入: x,y,x (LED的座標)
  80           **輸出: 無
  81           **功能: check one LED is ON
  82           *       檢查一個LED是否開啟或關閉
  83           * *************************************************************************************/
  84          unsigned char isOn(unsigned char x, unsigned char y, unsigned char z);
  85          
  86          /****************************************************************************************
  87           **函數: display
  88           **輸入: times  (每層delay時間)
  89           **輸出: 無
  90           **功能: Starting Display LED cube by this function
  91           *       用這個函式開始顯示LED 方塊
  92           **************************************************************************************/
  93          void display(unsigned char times);
  94          
  95          /****************************************************************************************
  96           *      main function
  97           *      主函式
  98           ***************************************************************************************/
  99          void main()
 100          {
 101   1          while(1){
 102   2            int x;
 103   2            init();
 104   2            turnOn(0,0,1);
 105   2          
 106   2            for (x = 0 ; x < 100 ; x++)
 107   2              display(2);
 108   2        
 109   2            turnOff(0,0,1);
 110   2            turnOn(2,2,2);
 111   2        
 112   2            for (x = 0 ; x < 100 ; x++)
 113   2              display(2);
 114   2          
 115   2            if (isOn(2,2,2)){
 116   3              turnOn(3,3,3);
C51 COMPILER V9.56.0.0   MAIN                                                              09/19/2016 16:00:49 PAGE 3   

 117   3            }else{
 118   3              turnOn(1,1,1);
 119   3              turnOn(1,1,2);
 120   3              turnOn(1,1,3);
 121   3              turnOn(1,1,4);
 122   3            }
 123   2          
 124   2            for (x = 0 ; x < 100 ; x++)
 125   2              display(2);
 126   2        }
 127   1      }
 128          
 129          
 130          /****************************************************************************************
 131           *      don't edit this section
 132           *      不要修改以下這段code
 133           * *************************************************************************************/
 134          void delay(unsigned int x)
 135          {
 136   1          unsigned int i,j;
 137   1          for (i = 0 ; i < x ; i++ )
 138   1             for (j = 0 ; j < 160 ; j++ );
 139   1      }
 140          
 141          void init()
 142          {
 143   1          CLOCK_PIN = 0;
 144   1          LATCH_PIN = 1;
 145   1          DATA_PIN = 0;
 146   1          LAYER_1 = 0;
 147   1          LAYER_2 = 0;
 148   1          LAYER_3 = 0;
 149   1          LAYER_4 = 0;
 150   1      }
 151          
 152          void shiftOut(unsigned char BitOrder,unsigned char val)
 153          {
 154   1          unsigned char i;
 155   1          for (i = 0 ; i < 8 ; i++){
 156   2              if (BitOrder == LSBFIRST)
 157   2                  DATA_PIN = !!(val & (1<<i));
 158   2              else
 159   2                  DATA_PIN = !!(val & (1<<(7-i)));
 160   2              //clock_delay();
 161   2              CLOCK_PIN = 1;
 162   2              //clock_delay();
 163   2              CLOCK_PIN = 0;
 164   2          }
 165   1      }
 166          
 167          void turnOn(unsigned char x, unsigned char y, unsigned char z)
 168          {
 169   1          LED[z] |= ( 1 << ((y << 2)+x));
 170   1      }
 171          
 172          void turnOff(unsigned char x, unsigned char y, unsigned char z)
 173          {
 174   1          LED[z] &= ~(1 << ((y<<2)+x));
 175   1      }
 176          
 177          unsigned char isOn(unsigned char x, unsigned char y, unsigned char z)
 178          {
C51 COMPILER V9.56.0.0   MAIN                                                              09/19/2016 16:00:49 PAGE 4   

 179   1          /*if (( LED[z] >> (( y << 2 ) + x ) ) & 1)
 180   1              return ON;
 181   1          else
 182   1              return OFF;*/
 183   1          return ( LED[z] >> (( y << 2 ) + x ) ) & 1 ;
 184   1      }
 185          
 186          void display(unsigned char times)
 187          {
 188   1          unsigned char i,high_byte,low_byte;
 189   1          for (i = 1 ; i <= 4 ; i ++ ){
 190   2              high_byte = LED[i] & 0xFF;
 191   2              low_byte =  LED[i] >> 8;
 192   2              LATCH_PIN = 0;
 193   2              shiftOut(LSBFIRST,high_byte);
 194   2              shiftOut(LSBFIRST,low_byte);
 195   2              LATCH_PIN = 1;  
 196   2              P1 = P1 & 0xE0;
 197   2              /*
 198   2                P1 |= 1 << (i+3);
 199   2              */
 200   2              switch(i){
 201   3                  case 1:
 202   3                      LAYER_1 = 1;
 203   3                      break;
 204   3                  case 2:
 205   3                      LAYER_2 = 1;
 206   3                      break;
 207   3                  case 3:
 208   3                      LAYER_3 = 1;
 209   3                      break;
 210   3                  case 4:
 211   3                      LAYER_3 = 1;
 212   3                      break;
 213   3              }
 214   2              delay(times);
 215   2          }
 216   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    536    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
