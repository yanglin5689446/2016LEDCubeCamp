C51 COMPILER V9.56.0.0   MAIN                                                              09/21/2016 23:52:28 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          
   2          /***************************************************************************************
   3           *  函式中變數宣告請宣告於函式開頭
   4           *
   5           *
   6           ***************************************************************************************/
   7          #include <regx51.h>
   8          
   9          /****************************************************************************************
  10           *      don't edit this section
  11           *      不要修改以下這段code
  12           * *************************************************************************************/
  13          #define DATA_PIN P1_0   //DS
  14          #define CLOCK_PIN P1_1  //SHCP
  15          #define LATCH_PIN P1_2  //STCP
  16          #define LAYER_1 P1_3
  17          #define LAYER_2 P1_4
  18          #define LAYER_3 P1_5
  19          #define LAYER_4 P1_6
  20          
  21          #define MSBFIRST 1
  22          #define LSBFIRST 2
  23          #define HIGH 1
  24          #define LOW 0
  25          #define ON 1
  26          #define OFF 0
  27          
  28          short LED[4];   //LED condition
  29          
  30          /****************************************************************************************
  31           **函數: delay
  32           **輸入: x
  33           **輸出: 無
  34           **功能: delay 1ms
  35           **************************************************************************************/
  36          void delay(unsigned int);
  37          
  38          /****************************************************************************************
  39           **函數: shiftOut
  40           **輸入: BitOrder(LSB first or MSB first),val
  41           **輸出: 無
  42           **功能: shift out data to DS
  43           **************************************************************************************/
  44          void shiftOut(unsigned char BitOrder,unsigned char val);
  45          void clock_delay();
  46          /****************************************************************************************
  47           *      you can call these function
  48           *      你可以使用以下函式
  49           **************************************************************************************/
  50          
  51          /****************************************************************************************
  52           **函數: init
  53           **輸入: 無
  54           **輸出: 無
C51 COMPILER V9.56.0.0   MAIN                                                              09/21/2016 23:52:28 PAGE 2   

  55           **功能: configure AT89C51 and 74HC595
  56           * *************************************************************************************/
  57          void init();
  58          
  59          /****************************************************************************************
  60           **函數: turnOn
  61           **輸入: x,y,x (LED的座標)
  62           **輸出: 無
  63           **功能: turn on one LED in data
  64           *       在資料庫中開啟一個LED
  65           * *************************************************************************************/
  66          void turnOn(unsigned char x, unsigned char y, unsigned char z);
  67          
  68          /****************************************************************************************
  69           **函數: turnOff
  70           **輸入: x,y,x (LED的座標)
  71           **輸出: 無
  72           **功能: turn off one LED in data
  73           *       在資料庫中關閉一個LED
  74           **************************************************************************************/
  75          void turnOff(unsigned char x, unsigned char y, unsigned char z);
  76          
  77          /****************************************************************************************
  78           **函數: isOn
  79           **輸入: x,y,x (LED的座標)
  80           **輸出: 無
  81           **功能: check one LED is ON
  82           *       檢查一個LED是否開啟或關閉
  83           * *************************************************************************************/
  84          unsigned char isOn(unsigned char x, unsigned char y, unsigned char z);
  85          
  86          /****************************************************************************************
  87           **函數: display
  88           **輸入: times  (每層delay時間)
  89           **輸出: 無
  90           **功能: Starting Display LED cube by this function
  91           *       用這個函式開始顯示LED 方塊
  92           **************************************************************************************/
  93          void display(unsigned char times);
  94          
  95          /****************************************************************************************
  96           *      main function
  97           *      主函式
  98           ***************************************************************************************/
  99          void main()
 100          {
 101   1          //int x;
 102   1          init();
 103   1          while(1){
 104   2          
 105   2            
 106   2            /*
 107   2            turnOn(0,0,1);
 108   2          
 109   2            for (x = 0 ; x < 100 ; x++)
 110   2              display(2);
 111   2        
 112   2            turnOff(0,0,1);
 113   2            turnOn(2,2,2);
 114   2        
 115   2            for (x = 0 ; x < 100 ; x++)
 116   2              display(2);
C51 COMPILER V9.56.0.0   MAIN                                                              09/21/2016 23:52:28 PAGE 3   

 117   2          
 118   2            if (isOn(2,2,2)){
 119   2              turnOn(3,3,3);
 120   2            }else{
 121   2              turnOn(1,1,1);
 122   2              turnOn(1,1,2);
 123   2              turnOn(1,1,3);
 124   2              turnOn(1,1,4);
 125   2            }
 126   2          
 127   2            for (x = 0 ; x < 100 ; x++)
 128   2              display(2);
 129   2              */
 130   2            LED[0] = 0xAAAA;
 131   2            turnOn(1,0,1);
 132   2            turnOn(3,0,1);
 133   2            turnOn(1,1,1);
 134   2            turnOn(3,1,1);
 135   2            turnOn(1,2,1);
 136   2            turnOn(3,2,1);
 137   2            turnOn(1,3,1);
 138   2            turnOn(3,3,1);
 139   2            LED[2] = 0xAAAA;
 140   2            LED[3] = 0xAAAA;
 141   2            while(1){
 142   3                display(10);
 143   3            }
 144   2        }
 145   1      }
 146          
 147          
 148          /****************************************************************************************
 149           *      don't edit this section
 150           *      不要修改以下這段code
 151           * *************************************************************************************/
 152          void delay(unsigned int x)
 153          {
 154   1          unsigned int i,j;
 155   1          for (i = 0 ; i < x ; i++ )
 156   1             for (j = 0 ; j < 160 ; j++ );
 157   1      }
 158          
 159          void init()
 160          {
 161   1          CLOCK_PIN = 0;
 162   1          LATCH_PIN = 1;
 163   1          DATA_PIN = 0;
 164   1          LAYER_1 = 0;
 165   1          LAYER_2 = 0;
 166   1          LAYER_3 = 0;
 167   1          LAYER_4 = 0;
 168   1          LED[0] = 0;
 169   1          LED[1] = 0;
 170   1          LED[2] = 0;
 171   1          LED[3] = 0;
 172   1      }
 173          
 174          void clock_delay()
 175          {
 176   1          unsigned i;
 177   1          for (i = 0 ; i < 5 ; i++);
 178   1      }
C51 COMPILER V9.56.0.0   MAIN                                                              09/21/2016 23:52:28 PAGE 4   

 179          
 180          
 181          void shiftOut(unsigned char BitOrder,unsigned char val)
 182          {
 183   1          unsigned char i;
 184   1          for (i = 0 ; i < 8 ; i++){
 185   2              if (BitOrder == LSBFIRST)
 186   2                  DATA_PIN = !!(val & (1<<i));
 187   2              else
 188   2                  DATA_PIN = !!(val & (1<<(7-i)));
 189   2              clock_delay();
 190   2              CLOCK_PIN = 1;
 191   2              clock_delay();
 192   2              CLOCK_PIN = 0;
 193   2          }
 194   1      }
 195          
 196          void turnOn(unsigned char x, unsigned char y, unsigned char z)
 197          {
 198   1          LED[z] |= ( 1 << ((y << 2)+x));
 199   1      }
 200          
 201          void turnOff(unsigned char x, unsigned char y, unsigned char z)
 202          {
 203   1          LED[z] &= ~(1 << ((y<<2)+x));
 204   1      }
 205          
 206          unsigned char isOn(unsigned char x, unsigned char y, unsigned char z)
 207          {
 208   1          /*if (( LED[z] >> (( y << 2 ) + x ) ) & 1)
 209   1              return ON;
 210   1          else
 211   1              return OFF;*/
 212   1          return ( LED[z] >> (( y << 2 ) + x ) ) & 1 ;
 213   1      }
 214          
 215          void display(unsigned char times)
 216          {
 217   1          int i;
 218   1          unsigned char high_byte,low_byte;
 219   1          for (i = 0 ; i < 4 ; i ++ ){
 220   2              high_byte = LED[i] & 0xFF;
 221   2              low_byte =  LED[i] >> 8;
 222   2              LATCH_PIN = 0;
 223   2              shiftOut(LSBFIRST,high_byte);
 224   2              shiftOut(LSBFIRST,low_byte);
 225   2              LATCH_PIN = 1;  
 226   2              P1 = P1 & 0x07;
 227   2              /*
 228   2                P1 |= 1 << (i+3);
 229   2              */
 230   2              /*switch(i){
 231   2                  case 0:
 232   2                  //    LAYER_1 = 1;
 233   2                      P1_3 = 1;
 234   2                      P1_4 = 0;
 235   2                      P1_5 = 0;
 236   2                      P1_6 = 0;
 237   2                      break;
 238   2                  case 1:
 239   2                  //    LAYER_2 = 1;
 240   2                      P1_3 = 0;
C51 COMPILER V9.56.0.0   MAIN                                                              09/21/2016 23:52:28 PAGE 5   

 241   2                      P1_4 = 1;
 242   2                      P1_5 = 0;
 243   2                      P1_6 = 0;
 244   2                      break;
 245   2                  case 2:
 246   2                  //    LAYER_3 = 1;
 247   2                      P1_3 = 0;
 248   2                      P1_4 = 0;
 249   2                      P1_5 = 1;
 250   2                      P1_6 = 0;
 251   2                      break;
 252   2                  case 3:
 253   2                  //    LAYER_4 = 1;
 254   2                      P1_3 = 0;
 255   2                      P1_4 = 0;
 256   2                      P1_5 = 1;
 257   2                      P1_6 = 0;
 258   2                      break;
 259   2                  default:
 260   2                      LAYER_1 = 1;
 261   2                      LAYER_2 = 1;
 262   2                      LAYER_3 = 1;
 263   2                      LAYER_4 = 1;
 264   2              }*/
 265   2              
 266   2              if( i == 0 ){
 267   3                LAYER_1 = 1;
 268   3              }else if( i == 1 ){
 269   3                LAYER_2 = 1;
 270   3              }else if( i == 2 ){
 271   3                LAYER_3 = 1;
 272   3              }else if( i == 3){
 273   3                LAYER_4 = 1;
 274   3              }
 275   2              delay(times);
 276   2          }
 277   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    530    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
